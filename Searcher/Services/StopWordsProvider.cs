using System;
using System.Collections.Generic;

namespace Searcher.Services;

/// <summary>
/// Управляет встроенным списком стоп-слов для фильтрации поисковых запросов.
/// </summary>
public class StopWordsProvider
{
    private static readonly string[] DefaultStopWords =
    {
        "и", "в", "во", "на", "к", "ко", "с", "со", "из", "у", "за", "по", "при", "о", "об", "обо", "от", "до",
        "под", "над", "перед", "после", "между", "про", "без", "через", "для", "около", "кроме", "меж",
        "не", "нет", "же", "ли", "бы", "ну", "да", "или", "а", "но", "как", "что", "чтобы",
        "если", "когда", "куда", "откуда", "почему", "зачем", "где", "тогда", "там", "тут", "зато", "поэтому",
        "это", "этот", "эта", "эти", "эту", "этим", "этом",
        "тот", "та", "то", "те", "того", "той", "тем", "том", "таким", "такая", "такое", "такие", "такой",
        "он", "она", "оно", "они", "я", "мы", "вы", "ты", "вы", "его", "её", "ее", "их", "нам", "вам", "ними",
        "сам", "сама", "само", "сами", "самим", "самих", "самому", "самой",
        "весь", "вся", "всё", "все", "всю", "всем", "всех", "каждый", "каждая", "каждое", "каждые",
        "только", "лишь", "даже", "ещё", "еще", "уже", "опять", "снова", "пока", "вновь",
        "был", "была", "было", "были", "буду", "будешь", "будет", "будем", "будете", "будут",
        "есть", "нету", "может", "нельзя",
        "который", "которая", "которое", "которые", "которого", "которому", "которым", "которых", "котором",
        "кажется", "типа", "примерно", "почти", "около", "ведь", "уж", "вроде",
        "либо", "то", "ибо", "всего", "сейчас", "теперь"
    };

    private readonly HashSet<string> _stopWords;

    private StopWordsProvider()
    {
        _stopWords = new HashSet<string>(DefaultStopWords, StringComparer.OrdinalIgnoreCase);
    }

    /// <summary>
    /// Создает провайдер со встроенным списком стоп-слов.
    /// </summary>
    public static StopWordsProvider CreateDefault()
    {
        return new StopWordsProvider();
    }

    /// <summary>
    /// Текущее количество стоп-слов.
    /// </summary>
    public int Count => _stopWords.Count;

    /// <summary>
    /// Проверяет, является ли токен стоп-словом.
    /// </summary>
    public bool IsStopWord(string? token)
    {
        if (string.IsNullOrWhiteSpace(token))
            return true;

        var normalized = TextPreprocessor.Normalize(token);
        return normalized.Length == 0 || _stopWords.Contains(normalized);
    }
}

